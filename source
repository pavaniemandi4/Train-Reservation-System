#include <stdio.h>
#include <stdlib.h>
#include <string.h>

struct Train {
    int number;
    char name[50];
    char from[30];
    char to[30];
    int totalSeats;
    int availableSeats;
};

struct Passenger {
    char name[50];
    int age;
    int trainNo;
    struct Passenger* next;
};

struct Passenger* head = NULL;
struct Train trains[5] = {
    {101, "Express One", "Vizag", "Hyderabad", 50, 50},
    {102, "Super Fast", "Vizag", "Chennai", 40, 40},
    {103, "Night Rider", "Vizag", "Bangalore", 30, 30},
    {104, "vande bharat express", "Vizag", "mumbai",55,55 },
    {105, "Godavari express", "Vizag", "Karnataka", 40,35}

};

// Display trains
void displayTrains() {
    printf("\nAvailable Trains:\n");
    printf("No\tName\t\tFrom\tTo\tSeats\n");
    for (int i = 0; i < 5; i++) {
        printf("%d\t%s\t%s\t%s\t%d\n",
               trains[i].number,
               trains[i].name,
               trains[i].from,
               trains[i].to,
               trains[i].availableSeats);
    }
}

// Find train index
int findTrain(int trainNo) {
    for (int i = 0; i < 5; i++) {
        if (trains[i].number == trainNo)
            return i;
    }
    return -1;
}

// Book ticket
void bookTicket() {
    int trainNo;
    char name[50];
    int age;

    displayTrains();
    printf("\nEnter Train Number: ");
    scanf("%d", &trainNo);

    int index = findTrain(trainNo);
    if (index == -1) {
        printf(" Invalid train number!\n");
        return;
    }

    if (trains[index].availableSeats <= 0) {
        printf(" No seats available!\n");
        return;
    }

    printf("Enter Passenger Name: ");
    scanf(" %[^\n]", name);
    printf("Enter Age: ");
    scanf("%d", &age);

    struct Passenger* newNode =
        (struct Passenger*)malloc(sizeof(struct Passenger));
    strcpy(newNode->name, name);
    newNode->age = age;
    newNode->trainNo = trainNo;
    newNode->next = head;
    head = newNode;

    trains[index].availableSeats--;
    printf(" Ticket booked successfully!\n");
}

// View bookings
void viewBookings() {
    struct Passenger* temp = head;
    if (temp == NULL) {
        printf("No bookings yet.\n");
        return;
    }
    printf("\nPassenger Bookings:\n");
    while (temp != NULL) {
        printf("Name: %s | Age: %d | Train No: %d\n",
               temp->name, temp->age, temp->trainNo);
        temp = temp->next;
    }
}

// Cancel ticket
void cancelTicket() {
    char name[50];
    printf("Enter passenger name to cancel: ");
    scanf(" %[^\n]", name);

    struct Passenger *temp = head, *prev = NULL;
    while (temp != NULL && strcmp(temp->name, name) != 0) {
        prev = temp;
        temp = temp->next;
    }

    if (temp == NULL) {
        printf(" Booking not found.\n");
        return;
    }

    int index = findTrain(temp->trainNo);
    if (index != -1)
        trains[index].availableSeats++;

    if (prev == NULL)
        head = temp->next;
    else
        prev->next = temp->next;

    free(temp);
    printf(" Ticket cancelled successfully!\n");
}

// Main menu
int main() {
    int choice;
    do {
        printf("\n--- Train Reservation System ---\n");
        printf("1. View Trains\n");
        printf("2. Book Ticket\n");
        printf("3. View Bookings\n");
        printf("4. Cancel Ticket\n");
        printf("5. Exit\n");
        printf("Enter choice: ");
        scanf("%d", &choice);

        switch (choice) {
        case 1: displayTrains(); break;
        case 2: bookTicket(); break;
        case 3: viewBookings(); break;
        case 4: cancelTicket(); break;
        case 5: printf("Exiting...\n"); break;
        default: printf("Invalid choice!\n");
        }
    } while (choice != 5);

    return 0;
}
